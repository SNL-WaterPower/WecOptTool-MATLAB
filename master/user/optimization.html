

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2. Optimizing an Existing WEC Model &mdash; WecOptTool 0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  <link rel="stylesheet" href="../_static/banner.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3. Creating a New WEC Model" href="model.html" />
    <link rel="prev" title="1. Setup" href="setup.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> WecOptTool
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="setup.html">1. Setup</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2. Optimizing an Existing WEC Model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">2.1. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-an-rm3-object">2.2. Create an RM3 object</a></li>
<li class="toctree-l2"><a class="reference internal" href="#define-a-seastate">2.3. Define a seastate</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-an-objective-function">2.4. Create an objective function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#define-the-inputs">2.4.1. Define the inputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#define-design-variables">2.4.2. Define design variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#add-a-controller">2.4.3. Add a controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-and-evaluate-the-device">2.4.4. Create and evaluate the device</a></li>
<li class="toctree-l3"><a class="reference internal" href="#define-the-objective-function-value">2.4.5. Define the objective function value</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#set-optimization-solver">2.5. Set optimization solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-study-and-view-results">2.6. Run study and view results</a></li>
<li class="toctree-l2"><a class="reference internal" href="#examine-optimum-device">2.7. Examine optimum device</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="model.html">3. Creating a New WEC Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">4. API</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">5. License</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">WecOptTool</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>2. Optimizing an Existing WEC Model</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/user/optimization.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  


    
    



    <p class="scv-banner scv-sphinx_rtd_theme"><b>Warning:</b> This document is for the development version of WecOptTool.</p>
<div class="section" id="optimizing-an-existing-wec-model">
<span id="optimization"></span><h1>2. Optimizing an Existing WEC Model<a class="headerlink" href="#optimizing-an-existing-wec-model" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>2.1. Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This section explains and expands upon the <a class="reference external" href="https://github.com/SNL-WaterPower/WecOptTool/blob/master/examples/RM3/optimization.m"><code class="docutils literal notranslate"><span class="pre">optimization.m</span></code></a> example file
provided in the <code class="docutils literal notranslate"><span class="pre">examples/RM3</span></code> directory of the WecOptTool source code. This
example considers the DOE Reference Model 3 (<a class="reference external" href="https://tethys-engineering.pnnl.gov/signature-projects/rm3-wave-point-absorber">RM3</a>) device.</p>
<details><summary><a>See the entire example file</a></summary></br><div class="highlight-matlab notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">%% optimization.m</span>
<span class="c">% Example of an optimization study, utilizing the RM3 blueprint defined in</span>
<span class="c">% the RM3.m file.</span>

<span class="c">%% Create RM3 blueprint.</span>
<span class="n">RM3Blueprint</span> <span class="p">=</span> <span class="n">RM3</span><span class="p">();</span>

<span class="c">%% Define and store sea state of interest</span>

<span class="c">% Create Bretschnider spectrum from WAFO</span>
<span class="c">% S = bretschneider([],[8,10],0);</span>

<span class="c">% Alternatively load a single example spectrum</span>
<span class="c">% S = WecOptLib.tests.data.exampleSpectrum();</span>

<span class="c">% Or load an example with multiple sea-states (8 differing spectra)</span>
<span class="n">S</span> <span class="p">=</span> <span class="n">WecOptLib</span><span class="p">.</span><span class="n">tests</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">example8Spectra</span><span class="p">();</span>

<span class="c">% Now store the sea-state in a SeaState data type</span>
<span class="n">SS</span> <span class="p">=</span> <span class="n">WecOptTool</span><span class="p">.</span><span class="n">types</span><span class="p">(</span><span class="s">&quot;SeaState&quot;</span><span class="p">,</span> <span class="n">S</span><span class="p">);</span>

<span class="c">%% Optimization Setup</span>

<span class="c">% Add geometry design variables (parametric)</span>
<span class="n">x0</span> <span class="p">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">,</span> <span class="mf">1.125</span><span class="p">,</span> <span class="mi">42</span><span class="p">];</span>
<span class="n">lb</span> <span class="p">=</span> <span class="p">[</span><span class="mf">4.5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mf">1.00</span><span class="p">,</span> <span class="mi">41</span><span class="p">];</span>
<span class="n">ub</span> <span class="p">=</span> <span class="p">[</span><span class="mf">5.5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">,</span> <span class="mi">43</span><span class="p">];</span>

<span class="c">% Define optimisation options</span>
<span class="n">opts</span> <span class="p">=</span> <span class="n">optimoptions</span><span class="p">(</span><span class="s">&#39;fmincon&#39;</span><span class="p">);</span>
<span class="n">opts</span><span class="p">.</span><span class="n">FiniteDifferenceType</span> <span class="p">=</span> <span class="s">&#39;central&#39;</span><span class="p">;</span>
<span class="n">opts</span><span class="p">.</span><span class="n">UseParallel</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
<span class="n">opts</span><span class="p">.</span><span class="n">MaxFunctionEvaluations</span> <span class="p">=</span> <span class="mi">5</span><span class="p">;</span> <span class="c">% set artificial low for fast running</span>
<span class="n">opts</span><span class="p">.</span><span class="n">Display</span> <span class="p">=</span> <span class="s">&#39;iter&#39;</span><span class="p">;</span>

<span class="c">% Enable dynamic plotting</span>
<span class="c">% opts.PlotFcn = {@optimplotx,@optimplotfval};</span>

<span class="c">% Define unused parameters</span>
<span class="n">A</span> <span class="p">=</span> <span class="p">[];</span>
<span class="n">B</span> <span class="p">=</span> <span class="p">[];</span>
<span class="n">Aeq</span> <span class="p">=</span> <span class="p">[];</span>
<span class="n">Beq</span> <span class="p">=</span> <span class="p">[];</span>
<span class="n">NONLCON</span> <span class="p">=</span> <span class="p">[];</span>

<span class="c">%% Optimization Execution</span>

<span class="c">% Create simple objective function handle</span>
<span class="n">objFun</span> <span class="p">=</span> <span class="p">@(</span><span class="n">x</span><span class="p">)</span> <span class="n">myWaveBotObjFun</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">RM3Blueprint</span><span class="p">,</span> <span class="n">SS</span><span class="p">);</span>

<span class="c">% Call the solver</span>
<span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">fval</span><span class="p">]</span> <span class="p">=</span> <span class="n">fmincon</span><span class="p">(</span><span class="n">objFun</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">Aeq</span><span class="p">,</span> <span class="n">Beq</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="n">NONLCON</span><span class="p">,</span> <span class="n">opts</span><span class="p">);</span>

<span class="c">%% Recover device object of best simulation and plot its power per freq</span>
<span class="n">devices</span> <span class="p">=</span> <span class="n">RM3Blueprint</span><span class="p">.</span><span class="n">recoverDevices</span><span class="p">();</span>
    
<span class="n">for</span> <span class="s">device</span> <span class="s">=</span> <span class="s">devices</span>
    <span class="n">if</span> <span class="s">isequal(device.geomParams(1:4),</span> <span class="s">num2cell(x))</span>
        <span class="n">bestDevice</span> <span class="p">=</span> <span class="n">device</span><span class="p">;</span>
        <span class="n">break</span>
    <span class="s">end</span>
<span class="k">end</span>

<span class="n">WecOptTool</span><span class="p">.</span><span class="n">plot</span><span class="p">.</span><span class="n">powerPerFreq</span><span class="p">(</span><span class="n">bestDevice</span><span class="p">);</span>

<span class="c">%% Define objective function</span>
<span class="c">% This can take any form that complies with the requirements of the MATLAB</span>
<span class="c">% optimization functions</span>

<span class="k">function</span><span class="w"> </span>[fval] <span class="p">=</span><span class="w"> </span><span class="nf">myWaveBotObjFun</span><span class="p">(</span>x, blueprint, seastate<span class="p">)</span><span class="w"></span>
<span class="w">    </span>
<span class="w">    </span><span class="n">geomMode</span><span class="p">.</span><span class="n">type</span> <span class="p">=</span> <span class="s">&#39;parametric&#39;</span><span class="p">;</span>
    <span class="n">geomMode</span><span class="p">.</span><span class="n">params</span> <span class="p">=</span> <span class="p">[</span><span class="n">num2cell</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span><span class="n">seastate</span> <span class="mf">0.5</span><span class="p">}];</span>
    <span class="n">cntrlMode</span><span class="p">.</span><span class="n">type</span> <span class="p">=</span> <span class="s">&#39;CC&#39;</span><span class="p">;</span>

    <span class="n">device</span> <span class="p">=</span> <span class="n">blueprint</span><span class="p">.</span><span class="n">makeDevices</span><span class="p">(</span><span class="n">geomMode</span><span class="p">,</span> <span class="n">cntrlMode</span><span class="p">);</span>
    <span class="n">device</span><span class="p">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">seastate</span><span class="p">);</span>
    <span class="n">fval</span> <span class="p">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">device</span><span class="p">.</span><span class="n">aggregation</span><span class="p">.</span><span class="n">pow</span><span class="p">;</span>
    
<span class="n">end</span>

<span class="s">%</span> <span class="s">Copyright</span> <span class="s">2020</span> <span class="s">National</span> <span class="s">Technology</span> <span class="s">&amp;</span> <span class="s">Engineering</span> <span class="s">Solutions</span> <span class="s">of</span> <span class="s">Sandia,</span> 
<span class="c">% LLC (NTESS). Under the terms of Contract DE-NA0003525 with NTESS, the </span>
<span class="c">% U.S. Government retains certain rights in this software.</span>
<span class="c">%</span>
<span class="c">% This file is part of WecOptTool.</span>
<span class="c">% </span>
<span class="c">%     WecOptTool is free software: you can redistribute it and/or modify</span>
<span class="c">%     it under the terms of the GNU General Public License as published by</span>
<span class="c">%     the Free Software Foundation, either version 3 of the License, or</span>
<span class="c">%     (at your option) any later version.</span>
<span class="c">% </span>
<span class="c">%     WecOptTool is distributed in the hope that it will be useful,</span>
<span class="c">%     but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c">%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c">%     GNU General Public License for more details.</span>
<span class="c">% </span>
<span class="c">%     You should have received a copy of the GNU General Public License</span>
<span class="c">%     along with WecOptTool.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>
</pre></div>
</td></tr></table></div>
</details></br><p>The general concept of WecOptTool is illustrated in the diagram below. In the
upper left-hand corner, an optimization algorithm controls the selection of a
set of design variables. In this diagram, some geometric design variables,
<span class="math notranslate nohighlight">\(r_1, r_2, d_1, d_2\)</span>, are considered along with constraints on the power
take-off (PTO) max force, <span class="math notranslate nohighlight">\(F_{max}\)</span>, and max stroke <span class="math notranslate nohighlight">\(\Delta
x_{max}\)</span> and an operational constraint, <span class="math notranslate nohighlight">\(H_{s,max}\)</span>. The device defined
by these design variables is passed to the grey <em>evaluation</em> block. Here,
<a class="reference external" href="https://github.com/LHEEA/Nemoh">Nemoh</a> is used to compute the linear wave-body interaction properties using the
boundary element method (BEM). Next, using these properties and some set of sea
states, one of three controllers (<code class="docutils literal notranslate"><span class="pre">ProportionalDamping</span></code>,
<code class="docutils literal notranslate"><span class="pre">ComplexConjugate</span></code>, <code class="docutils literal notranslate"><span class="pre">PseudoSpectral</span></code>) are used to compute the resulting
dynamics. These dynamics and some model for cost (e.g., based on the size
dimensions and the capabilities of the PTO) can be combined to produce an
objective function, which is returned to the optimization solver.</p>
<img alt="Conceptual illustration of WecOptTool functionality" src="../_images/WecOptTool_algorithmDiagram.svg" /><p>In WecOptTool, this process is executed by applying the following steps:</p>
<ol class="arabic simple">
<li>Select a WEC Blueprint (RM3, in this case)</li>
<li>Create one or many Devices using the Blueprint</li>
<li>Examine the performance each Device object for a given seastate</li>
</ol>
<p>The remainder of this page will illustrate (using the <a class="reference external" href="https://github.com/SNL-WaterPower/WecOptTool/blob/master/examples/RM3/optimization.m"><code class="docutils literal notranslate"><span class="pre">optimization.m</span></code></a>
example) how this process is applied to a co-optimisation problem. For more
information about the <a class="reference internal" href="api.html#+WecOptTool.Blueprint" title="+WecOptTool.Blueprint"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">Blueprint</span></code></a> and
<a class="reference internal" href="api.html#+WecOptTool.Device" title="+WecOptTool.Device"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">Device</span></code></a> classes see the <a class="reference internal" href="model.html#model"><span class="std std-ref">Creating a New WEC Model</span></a> and <a class="reference internal" href="api.html#api"><span class="std std-ref">API</span></a>
sections.</p>
</div>
<div class="section" id="create-an-rm3-object">
<h2>2.2. Create an RM3 object<a class="headerlink" href="#create-an-rm3-object" title="Permalink to this headline">¶</a></h2>
<p>Once defined, <a class="reference internal" href="api.html#+WecOptTool.Blueprint" title="+WecOptTool.Blueprint"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">Blueprint</span></code></a> subclasses are easy to
initialize:</p>
<div class="highlight-matlab notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">%% Create RM3 blueprint.</span>
<span class="n">RM3Blueprint</span> <span class="p">=</span> <span class="n">RM3</span><span class="p">();</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="define-a-seastate">
<h2>2.3. Define a seastate<a class="headerlink" href="#define-a-seastate" title="Permalink to this headline">¶</a></h2>
<p>WecOptTool can simulate single or multiple spectra sea states, where weightings
can be provided to indicate the relative likelihood of each spectra. The
following lines from <a class="reference external" href="https://github.com/SNL-WaterPower/WecOptTool/blob/master/examples/RM3/optimization.m"><code class="docutils literal notranslate"><span class="pre">optimization.m</span></code></a> provide means of using the <a class="reference external" href="http://www.maths.lth.se/matstat/wafo/">WAFO</a> MATLAB
toolbox or preset spectra from WecOptTool.</p>
<div class="highlight-matlab notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">%% Define and store sea state of interest</span>

<span class="c">% Create Bretschnider spectrum from WAFO</span>
<span class="c">% S = bretschneider([],[8,10],0);</span>

<span class="c">% Alternatively load a single example spectrum</span>
<span class="c">% S = WecOptLib.tests.data.exampleSpectrum();</span>

<span class="c">% Or load an example with multiple sea-states (8 differing spectra)</span>
<span class="n">S</span> <span class="p">=</span> <span class="n">WecOptLib</span><span class="p">.</span><span class="n">tests</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">example8Spectra</span><span class="p">();</span>
</pre></div>
</td></tr></table></div>
<p>Spectra are formatted following the convention of the <a class="reference external" href="http://www.maths.lth.se/matstat/wafo/">WAFO</a> MATLAB toolbox, but
can be generated in via any means (e.g., from buoy measurements) as long as the
structure includes the <code class="docutils literal notranslate"><span class="pre">S.S</span></code>, <code class="docutils literal notranslate"><span class="pre">S.w</span></code>, and <code class="docutils literal notranslate"><span class="pre">S.phi</span></code> fields.</p>
<div class="code matlab highlight-default notranslate"><div class="highlight"><pre><span></span>S =

  struct with fields:

       S: [257×1 double]
       w: [257×1 double]
      tr: []
       h: Inf
    type: &#39;freq&#39;
     phi: 0
    norm: 0
    note: &#39;Bretschneider, Hm0 = 4, Tp = 5&#39;
    date: &#39;25-Mar-2020 13:08:28&#39;
</pre></div>
</div>
<p>In the active code above from <a class="reference external" href="https://github.com/SNL-WaterPower/WecOptTool/blob/master/examples/RM3/optimization.m"><code class="docutils literal notranslate"><span class="pre">optimization.m</span></code></a>, there are eight spectra loaded into
a <a class="reference external" href="https://www.mathworks.com/help/matlab/matlab_prog/create-a-structure-array.html">struct array</a>. These can be plotted using standard MATLAB commands.</p>
<div class="code matlab highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">figure</span>
<span class="n">hold</span> <span class="n">on</span>
<span class="n">grid</span> <span class="n">on</span>
<span class="n">arrayfun</span><span class="p">(</span><span class="o">@</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">w</span><span class="p">,</span><span class="n">x</span><span class="o">.</span><span class="n">S</span><span class="p">,</span><span class="s1">&#39;DisplayName&#39;</span><span class="p">,</span><span class="n">x</span><span class="o">.</span><span class="n">note</span><span class="p">),</span> <span class="n">S</span><span class="p">)</span>
<span class="n">legend</span><span class="p">()</span>
<span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Freq. [rad/s]&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Spect. density [m^2 rad/s]&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="Eight spectra consider in example.m" src="../_images/example_spectra.svg" /><p>The desired spectrum or spectra must now be converted into a
<a class="reference internal" href="api.html#+WecOptTool.+types.SeaState" title="+WecOptTool.+types.SeaState"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">SeaState</span></code></a> data type object.</p>
<div class="highlight-matlab notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">% Now store the sea-state in a SeaState data type</span>
<span class="n">SS</span> <span class="p">=</span> <span class="n">WecOptTool</span><span class="p">.</span><span class="n">types</span><span class="p">(</span><span class="s">&quot;SeaState&quot;</span><span class="p">,</span> <span class="n">S</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>The purpose of data type classes is to validate that the required parameters
for the different stages of the design process have been provided, to give the
user a clear method to understand and access the data used in WecOptTool and,
in some circumstances, to add additional data that is automatically generated
from the given variables. For instances, for the
<a class="reference internal" href="api.html#+WecOptTool.+types.SeaState" title="+WecOptTool.+types.SeaState"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">SeaState</span></code></a> class, the weighting parameter <code class="docutils literal notranslate"><span class="pre">mu</span></code>
will be set to unity when multiple seastates are given with <code class="docutils literal notranslate"><span class="pre">mu</span></code> left
undefined. The <a class="reference internal" href="api.html#+WecOptTool.types" title="+WecOptTool.types"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">WecOptTool.types()</span></code></a> function is the preferred method
for creating data type object arrays.</p>
</div>
<div class="section" id="create-an-objective-function">
<h2>2.4. Create an objective function<a class="headerlink" href="#create-an-objective-function" title="Permalink to this headline">¶</a></h2>
<p>Next, we create the objective function we wish to minimise. Note, this
function must be defined at the bottom of the script, although we will use
it above. The full function is as follows:</p>
<div class="highlight-matlab notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>65
66
67
68
69
70
71
72
73
74
75
76
77
78
79</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">%% Define objective function</span>
<span class="c">% This can take any form that complies with the requirements of the MATLAB</span>
<span class="c">% optimization functions</span>

<span class="k">function</span><span class="w"> </span>[fval] <span class="p">=</span><span class="w"> </span><span class="nf">myWaveBotObjFun</span><span class="p">(</span>x, blueprint, seastate<span class="p">)</span><span class="w"></span>
<span class="w">    </span>
<span class="w">    </span><span class="n">geomMode</span><span class="p">.</span><span class="n">type</span> <span class="p">=</span> <span class="s">&#39;parametric&#39;</span><span class="p">;</span>
    <span class="n">geomMode</span><span class="p">.</span><span class="n">params</span> <span class="p">=</span> <span class="p">[</span><span class="n">num2cell</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span><span class="n">seastate</span> <span class="mf">0.5</span><span class="p">}];</span>
    <span class="n">cntrlMode</span><span class="p">.</span><span class="n">type</span> <span class="p">=</span> <span class="s">&#39;CC&#39;</span><span class="p">;</span>

    <span class="n">device</span> <span class="p">=</span> <span class="n">blueprint</span><span class="p">.</span><span class="n">makeDevices</span><span class="p">(</span><span class="n">geomMode</span><span class="p">,</span> <span class="n">cntrlMode</span><span class="p">);</span>
    <span class="n">device</span><span class="p">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">seastate</span><span class="p">);</span>
    <span class="n">fval</span> <span class="p">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">device</span><span class="p">.</span><span class="n">aggregation</span><span class="p">.</span><span class="n">pow</span><span class="p">;</span>
    
<span class="n">end</span>
</pre></div>
</td></tr></table></div>
<p>The following subsections will describe each stage of setting up the objective
function.</p>
<div class="section" id="define-the-inputs">
<h3>2.4.1. Define the inputs<a class="headerlink" href="#define-the-inputs" title="Permalink to this headline">¶</a></h3>
<p>The input definition of an objective function used in WecOptTool is typically
going to take the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">result</span> <span class="o">=</span> <span class="n">myObjFun</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">blueprint</span><span class="p">,</span> <span class="n">seastate</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">x</span></code> is the solution to be tested, <code class="docutils literal notranslate"><span class="pre">blueprint</span></code> is a Blueprint subclass
object and <code class="docutils literal notranslate"><span class="pre">seastate</span></code> is a SeaState data type object. Although in most cases
only <code class="docutils literal notranslate"><span class="pre">x</span></code> will vary, the other inputs will be required within the optimization
function and can’t be accessed through the global workspace.</p>
</div>
<div class="section" id="define-design-variables">
<h3>2.4.2. Define design variables<a class="headerlink" href="#define-design-variables" title="Permalink to this headline">¶</a></h3>
<p>As shown in the diagram below, for RM3 study considered in <a class="reference external" href="https://github.com/SNL-WaterPower/WecOptTool/blob/master/examples/RM3/optimization.m"><code class="docutils literal notranslate"><span class="pre">optimization.m</span></code></a>
the design variables are the radius of the surface float, <code class="docutils literal notranslate"><span class="pre">r1</span></code>, the radius of
the heave plate, <code class="docutils literal notranslate"><span class="pre">r2</span></code>, the draft of the surface float, <code class="docutils literal notranslate"><span class="pre">d1</span></code>, and the depth
of the heave plate, <code class="docutils literal notranslate"><span class="pre">d2</span></code>, such that <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">[r1,</span> <span class="pre">r2,</span> <span class="pre">d1,</span> <span class="pre">d2]</span></code>. The
optimization algorithm will attempt to find the values of <code class="docutils literal notranslate"><span class="pre">x</span></code> that minimize
the objective function.</p>
<a class="reference internal image-reference" href="../_images/example_rm3Parametric.svg"><img alt="RM3 device parametric dimensions" src="../_images/example_rm3Parametric.svg" width="400pt" /></a>
<p>In WecOptTool, design options for geometry and controllers are supplied in
<a class="reference external" href="https://uk.mathworks.com/help/matlab/matlab_prog/create-a-structure-array.html">struct arrays</a>
using the field <code class="docutils literal notranslate"><span class="pre">type</span></code> to define which option is desired and <code class="docutils literal notranslate"><span class="pre">params</span></code> to
supply the chosen option with it’s required parameters, in a cell array. For
the <code class="docutils literal notranslate"><span class="pre">'parametric'</span></code> option, 6 arguments must be supplied, the geometry design
variables, <code class="docutils literal notranslate"><span class="pre">r1,</span> <span class="pre">r2,</span> <span class="pre">d1,</span> <span class="pre">d2</span></code>, a representative seastate and the frequency step
to be used for the NEMOH calculations. The design variables will be passed by
the optimisation routine, so we add the seastate and the frequency step as
follows:</p>
<div class="highlight-matlab notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>72
73</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="n">geomMode</span><span class="p">.</span><span class="n">type</span> <span class="p">=</span> <span class="s">&#39;parametric&#39;</span><span class="p">;</span>
    <span class="n">geomMode</span><span class="p">.</span><span class="n">params</span> <span class="p">=</span> <span class="p">[</span><span class="n">num2cell</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span><span class="n">seastate</span> <span class="mf">0.5</span><span class="p">}];</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="add-a-controller">
<h3>2.4.3. Add a controller<a class="headerlink" href="#add-a-controller" title="Permalink to this headline">¶</a></h3>
<p>In the RM3 example, three types of controllers are defined:</p>
<blockquote>
<div><ul>
<li><p class="first"><strong>Proportional Damping</strong> (<code class="docutils literal notranslate"><span class="pre">'P'</span></code>): Resistive damping (i.e., a proportional
feedback on velocity) (see, e.g., <a class="reference internal" href="#falnes" id="id1">[Falnes]</a>). Here, the power take-off (PTO)
force is set as</p>
<div class="math notranslate nohighlight">
\[F_u(\omega) = -B_{PTO}(\omega)u(\omega)\]</div>
<p>where <span class="math notranslate nohighlight">\(B_{PTO}\)</span> is a constant chosen to maximize absorbed power and
<span class="math notranslate nohighlight">\(u(\omega)\)</span> is the velocity. <br /> <br /></p>
</li>
<li><p class="first"><strong>Complex Conjugate</strong> (<code class="docutils literal notranslate"><span class="pre">'CC'</span></code>): Optimal power absorption through impedance
matching (see, e.g., <a class="reference internal" href="#falnes" id="id2">[Falnes]</a>). The intrinsic impedance is given by</p>
<div class="math notranslate nohighlight">
\[Z_i(\omega) = B(\omega) + i \left( \omega{}(m + A(\omega)) - \frac{K_{HS}}{\omega}\right) ,\]</div>
<p>where <span class="math notranslate nohighlight">\(\omega\)</span> is the radial frequency, <span class="math notranslate nohighlight">\(B(\omega)\)</span> is the
radiation damping, <span class="math notranslate nohighlight">\(m\)</span> is the rigid body mass, <span class="math notranslate nohighlight">\(A(\omega)\)</span> is the
added mass, and <span class="math notranslate nohighlight">\(K_{HS}\)</span> is the hydrostatic stiffness. Optimal power
transfer occurs when the PTO force, <span class="math notranslate nohighlight">\(F_u\)</span> is set such
that</p>
<div class="math notranslate nohighlight">
\[F_u(\omega) = -Z_i^*(\omega)u(\omega) ,\]</div>
<p>where <span class="math notranslate nohighlight">\(u(\omega)\)</span> is the velocity. <br /> <br /></p>
</li>
<li><p class="first"><strong>Pseudo Spectral</strong> (<code class="docutils literal notranslate"><span class="pre">'PS'</span></code>): Constrained optimal power absorption
<a class="reference internal" href="#bacelli" id="id3">[Bacelli]</a>. This is a numerical optimal control algorithm capable of dealing
with both constraints and nonlinear dynamics. This approach is based on
<a class="reference external" href="https://en.wikipedia.org/wiki/Pseudospectral_optimal_control">pseudo spectral optimal control</a>.</p>
</li>
</ul>
</div></blockquote>
<p>For the <a class="reference external" href="https://github.com/SNL-WaterPower/WecOptTool/blob/master/examples/RM3/optimization.m"><code class="docutils literal notranslate"><span class="pre">optimization.m</span></code></a> example we choose the Complex Conjugate option, which
requires no additional arguments:</p>
<div class="highlight-matlab notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>74</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="n">cntrlMode</span><span class="p">.</span><span class="n">type</span> <span class="p">=</span> <span class="s">&#39;CC&#39;</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="create-and-evaluate-the-device">
<h3>2.4.4. Create and evaluate the device<a class="headerlink" href="#create-and-evaluate-the-device" title="Permalink to this headline">¶</a></h3>
<p>Now that the design options are set, the devices can be created and their
performance evaluated for a given seastate. To create the device, the
<a class="reference internal" href="api.html#+WecOptTool.Blueprint.makeDevices" title="+WecOptTool.Blueprint.makeDevices"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">makeDevices()</span></code></a> method of the <code class="docutils literal notranslate"><span class="pre">RM3</span></code> object
is used with the defined geometry and controller options:</p>
<div class="highlight-matlab notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>76</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="n">device</span> <span class="p">=</span> <span class="n">blueprint</span><span class="p">.</span><span class="n">makeDevices</span><span class="p">(</span><span class="n">geomMode</span><span class="p">,</span> <span class="n">cntrlMode</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>To evaluate the device’s performance, the
<a class="reference internal" href="api.html#+WecOptTool.Device.simulate" title="+WecOptTool.Device.simulate"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">simulate()</span></code></a> method is called on the created
device with the given <a class="reference internal" href="api.html#+WecOptTool.+types.SeaState" title="+WecOptTool.+types.SeaState"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">SeaState</span></code></a> object.</p>
<div class="highlight-matlab notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>77</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="n">device</span><span class="p">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">seastate</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="define-the-objective-function-value">
<h3>2.4.5. Define the objective function value<a class="headerlink" href="#define-the-objective-function-value" title="Permalink to this headline">¶</a></h3>
<p>The final step is to use data stored in the device to define the objective
function value. The <a class="reference internal" href="api.html#+WecOptTool.Device" title="+WecOptTool.Device"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">Device</span></code></a> definition gives a full
list of the data available in the device, but for this case ‘aggregated
results’ found in the <code class="xref mat mat-attr docutils literal notranslate"><span class="pre">aggregation</span></code> property
(which is populated by a user defined callback) are used. In <a class="reference external" href="https://github.com/SNL-WaterPower/WecOptTool/blob/master/examples/RM3/RM3.m"><code class="docutils literal notranslate"><span class="pre">RM3.m</span></code></a> the
maximum absorbed power across all spectra in the given seastate is calculated
and added as <code class="docutils literal notranslate"><span class="pre">pow</span></code>. To make a minimisation problem, the negation of this
value is taken:</p>
<div class="highlight-matlab notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>78</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="n">fval</span> <span class="p">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">device</span><span class="p">.</span><span class="n">aggregation</span><span class="p">.</span><span class="n">pow</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>Objective function:</strong> The chosen objective function in|optimization.m|_
can be altered to better approximate a more meaningful objective (e.g.,
levelized cost of energy).</p>
</div>
</div>
</div>
<div class="section" id="set-optimization-solver">
<h2>2.5. Set optimization solver<a class="headerlink" href="#set-optimization-solver" title="Permalink to this headline">¶</a></h2>
<p>MATLAB’s <a class="reference external" href="https://uk.mathworks.com/help/optim/ug/fmincon.html">fmincon</a>
optimization solver is used in <a class="reference external" href="https://github.com/SNL-WaterPower/WecOptTool/blob/master/examples/RM3/optimization.m"><code class="docutils literal notranslate"><span class="pre">optimization.m</span></code></a>.</p>
<p>The initial values, <code class="docutils literal notranslate"><span class="pre">x0</span></code>, lower bounds, <code class="docutils literal notranslate"><span class="pre">lb</span></code>, and upper bounds,
<code class="docutils literal notranslate"><span class="pre">ub</span></code> of the design variables can be set as follows.</p>
<div class="highlight-matlab notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">% Add geometry design variables (parametric)</span>
<span class="n">x0</span> <span class="p">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">,</span> <span class="mf">1.125</span><span class="p">,</span> <span class="mi">42</span><span class="p">];</span>
<span class="n">lb</span> <span class="p">=</span> <span class="p">[</span><span class="mf">4.5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mf">1.00</span><span class="p">,</span> <span class="mi">41</span><span class="p">];</span>
<span class="n">ub</span> <span class="p">=</span> <span class="p">[</span><span class="mf">5.5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">,</span> <span class="mi">43</span><span class="p">];</span>
</pre></div>
</td></tr></table></div>
<p>Options can also be supplied for fmincon:</p>
<div class="highlight-matlab notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">% Define optimisation options</span>
<span class="n">opts</span> <span class="p">=</span> <span class="n">optimoptions</span><span class="p">(</span><span class="s">&#39;fmincon&#39;</span><span class="p">);</span>
<span class="n">opts</span><span class="p">.</span><span class="n">FiniteDifferenceType</span> <span class="p">=</span> <span class="s">&#39;central&#39;</span><span class="p">;</span>
<span class="n">opts</span><span class="p">.</span><span class="n">UseParallel</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
<span class="n">opts</span><span class="p">.</span><span class="n">MaxFunctionEvaluations</span> <span class="p">=</span> <span class="mi">5</span><span class="p">;</span> <span class="c">% set artificial low for fast running</span>
<span class="n">opts</span><span class="p">.</span><span class="n">Display</span> <span class="p">=</span> <span class="s">&#39;iter&#39;</span><span class="p">;</span>

<span class="c">% Enable dynamic plotting</span>
<span class="c">% opts.PlotFcn = {@optimplotx,@optimplotfval};</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">MaxFunctionEvaluations</span></code> is set to 5 in <a class="reference external" href="https://github.com/SNL-WaterPower/WecOptTool/blob/master/examples/RM3/optimization.m"><code class="docutils literal notranslate"><span class="pre">optimization.m</span></code></a> to permit
relatively quick runs, but can be increased to allow for a potentially
better solution (with the other options left as-is, this should require 150
function evaluations).</p>
</div>
<img alt="Progression of objective function value for RM3 example" src="../_images/example_optimplotfval.svg" /><p>In order to pass the above options, some dummy values must also be supplied for
other arguments required by fmincon:</p>
<div class="highlight-matlab notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>39
40
41
42
43
44</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">% Define unused parameters</span>
<span class="n">A</span> <span class="p">=</span> <span class="p">[];</span>
<span class="n">B</span> <span class="p">=</span> <span class="p">[];</span>
<span class="n">Aeq</span> <span class="p">=</span> <span class="p">[];</span>
<span class="n">Beq</span> <span class="p">=</span> <span class="p">[];</span>
<span class="n">NONLCON</span> <span class="p">=</span> <span class="p">[];</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="run-study-and-view-results">
<h2>2.6. Run study and view results<a class="headerlink" href="#run-study-and-view-results" title="Permalink to this headline">¶</a></h2>
<p>Before using the objective function, the inputs must be simplified to allow
fmincon to just pass the design variables. To do this an <a class="reference external" href="https://uk.mathworks.com/help/matlab/matlab_prog/anonymous-functions.html">anonymous function</a>
is defined, which requires the design variables as input and fixes the value of
the Blueprint and SeaState object inputs:</p>
<div class="highlight-matlab notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>48
49</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">% Create simple objective function handle</span>
<span class="n">objFun</span> <span class="p">=</span> <span class="p">@(</span><span class="n">x</span><span class="p">)</span> <span class="n">myWaveBotObjFun</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">RM3Blueprint</span><span class="p">,</span> <span class="n">SS</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>The study can be executed by calling fmincon:</p>
<div class="highlight-matlab notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>51
52</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">% Call the solver</span>
<span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">fval</span><span class="p">]</span> <span class="p">=</span> <span class="n">fmincon</span><span class="p">(</span><span class="n">objFun</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">Aeq</span><span class="p">,</span> <span class="n">Beq</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="n">NONLCON</span><span class="p">,</span> <span class="n">opts</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>Once the calculation is complete, the <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">fval</span></code> variables show that
the study has produced the following design:</p>
<ul class="simple">
<li>r1: 5 [m]</li>
<li>r2: 7.5 [m]</li>
<li>d1: 1.125 [m]</li>
<li>d2: 42 [m]</li>
<li>Maximum absorbed power: 2357934.25081 [W]</li>
</ul>
</div>
<div class="section" id="examine-optimum-device">
<h2>2.7. Examine optimum device<a class="headerlink" href="#examine-optimum-device" title="Permalink to this headline">¶</a></h2>
<p>When MATLAB is executed in parallel, objects are copied to the parallel
workers, executed and then destroyed. Therefore only the function value of each
iteration remains in the MATLAB workspace. To allow the created devices to be
recovered, WecOptTool stores their data in files, so that it can be retrieved
later if desired. To recover the devices, the
<a class="reference internal" href="api.html#+WecOptTool.Blueprint.recoverDevices" title="+WecOptTool.Blueprint.recoverDevices"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">recoverDevices()</span></code></a> method of the Blueprint
subclass is called, which returns an array of <a class="reference internal" href="api.html#+WecOptTool.Device" title="+WecOptTool.Device"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">Device</span></code></a>
objects:</p>
<div class="highlight-matlab notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>54
55</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">%% Recover device object of best simulation and plot its power per freq</span>
<span class="n">devices</span> <span class="p">=</span> <span class="n">RM3Blueprint</span><span class="p">.</span><span class="n">recoverDevices</span><span class="p">();</span>
</pre></div>
</td></tr></table></div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Once recovered, ownership of the files containing the stored data for
the devices is transferred from the Blueprint to the Device objects.
Therefore, when the Device objects are deleted, so are the associated
files.</p>
</div>
<p>Next, the device that matches the best solution returned by fmincon must
be found. To do this, compare the <code class="xref mat mat-attr docutils literal notranslate"><span class="pre">geomParams</span></code>
parameter of the devices, until a match is found, as follows:</p>
<div class="highlight-matlab notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>57
58
59
60
61
62</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">device</span> <span class="p">=</span> <span class="n">devices</span>
    <span class="n">if</span> <span class="s">isequal(device.geomParams(1:4),</span> <span class="s">num2cell(x))</span>
        <span class="n">bestDevice</span> <span class="p">=</span> <span class="n">device</span><span class="p">;</span>
        <span class="n">break</span>
    <span class="s">end</span>
<span class="k">end</span>
</pre></div>
</td></tr></table></div>
<p>Finally, by using the <a class="reference internal" href="api.html#+WecOptTool.+plot.powerPerFreq" title="+WecOptTool.+plot.powerPerFreq"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">WecOptTool.plot.powerPerFreq()</span></code></a> function, the
spectral distribution of energy absorbed by the resulting design for each of
the eight sea states can be shown.</p>
<div class="highlight-matlab notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>64</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">WecOptTool</span><span class="p">.</span><span class="n">plot</span><span class="p">.</span><span class="n">powerPerFreq</span><span class="p">(</span><span class="n">bestDevice</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<a class="reference internal image-reference" href="../_images/example_spectralPowerPlot.svg"><img alt="Absorbed Spectral power distribution for each sea state" src="../_images/example_spectralPowerPlot.svg" width="400pt" /></a>
<table class="docutils citation" frame="void" id="falnes" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[Falnes]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id2">2</a>)</em> Falnes, Johannes. Ocean waves and oscillating systems: linear
interactions including wave-energy extraction. Cambridge University
Press, 2002.</td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="bacelli" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[Bacelli]</a></td><td>Bacelli, Giorgio, and John V. Ringwood. “Numerical optimal control
of wave energy converters.” IEEE Transactions on Sustainable Energy 6.2
(2014): 294-302.</td></tr>
</tbody>
</table>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="model.html" class="btn btn-neutral float-right" title="3. Creating a New WEC Model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="setup.html" class="btn btn-neutral float-left" title="1. Setup" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020 National Technology and Engineering Solutions of Sandia, LLC

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: master
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Tags</dt>
            <dd><a href="../../v0.1.0/index.html">v0.1.0</a></dd>
        </dl>
        <dl>
            <dt>Branches</dt>
            <dd><a href="optimization.html">master</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>